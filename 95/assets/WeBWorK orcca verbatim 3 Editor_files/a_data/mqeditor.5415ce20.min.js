"use strict";(()=>{window.answerQuills={};const t=MathQuill.getInterface(2);let e="true"===(localStorage.getItem("MQEditorToolbarEnabled")??"true");const o=o=>{const n=o.id.replace(/^MaThQuIlL_/,""),a=document.getElementById(n),s=a?.type;if("string"!=typeof s||"text"!==s.toLowerCase()||!a.classList.contains("codeshard"))return;const l=document.createElement("span");l.id=`mq-answer-${n}`,l.input=a,a.classList.add("mq-edit"),l.latexInput=o,a.after(l);const i={spaceBehavesLikeTab:!0,leftRightIntoCmdGoes:"up",restrictMismatchedBrackets:!0,sumStartsWithNEquals:!0,supSubsRequireOperand:!0,autoCommands:"pi sqrt root vert inf union abs",rootsAreExponents:!0,maxDepth:10};l.latexInput.dataset.mqOpts&&Object.assign(i,JSON.parse(l.latexInput.dataset.mqOpts)),i.handlers={edit:t=>{""!==t.text()?(l.input.value=t.text().trim(),l.latexInput.value=t.latex().replace(/^(?:\\\s)*(.*?)(?:\\\s)*$/,"$1")):(l.input.value="",l.latexInput.value="")},textBlockEnter:()=>{l.toolbar&&l.toolbar.querySelectorAll("button").forEach((t=>t.disabled=!0))},textBlockExit:()=>{l.toolbar&&l.toolbar.querySelectorAll("button").forEach((t=>t.disabled=!1))}},l.mathField=t.MathField(l,i),l.textarea=l.querySelector("textarea"),l.buttons=[{id:"frac",latex:"/",tooltip:"fraction (/)",icon:"\\frac{\\text{ }}{\\text{ }}"},{id:"abs",latex:"|",tooltip:"absolute value (|)",icon:"|\\text{ }|"},{id:"sqrt",latex:"\\sqrt",tooltip:"square root (sqrt)",icon:"\\sqrt{\\text{ }}"},{id:"nthroot",latex:"\\root",tooltip:"nth root (root)",icon:"\\sqrt[\\text{ }]{\\text{ }}"},{id:"exponent",latex:"^",tooltip:"exponent (^)",icon:"\\text{ }^\\text{ }"},{id:"infty",latex:"\\infty",tooltip:"infinity (inf)",icon:"\\infty"},{id:"pi",latex:"\\pi",tooltip:"pi (pi)",icon:"\\pi"},{id:"vert",latex:"\\vert",tooltip:"such that (vert)",icon:"|"},{id:"cup",latex:"\\cup",tooltip:"union (union)",icon:"\\cup"},{id:"text",latex:"\\text",tooltip:'text mode (")',icon:"Tt"}],l.hasFocus=!1;const r=()=>{if(!l.hasFocus&&l.toolbar){const t=l.toolbar;delete l.toolbar,t.style.opacity=0,t.addEventListener("transitionend",(()=>{window.removeEventListener("resize",t.setPosition),t.tooltips.forEach((t=>t.dispose())),t.remove()}))}};l.textarea.addEventListener("focusin",(()=>{if(e&&(l.hasFocus=!0,!l.toolbar)){l.toolbar=document.createElement("div"),l.toolbar.tabIndex=-1,l.toolbar.classList.add("quill-toolbar"),l.toolbar.style.opacity=0,l.toolbar.addEventListener("focusin",(t=>l.hasFocus=!0)),l.toolbar.addEventListener("focusout",(t=>{l.hasFocus=!1,setTimeout(r,200)})),l.toolbar.tooltips=[];for(const e of l.buttons){const o=document.createElement("button");o.type="button",o.id=`${e.id}-${l.id}`,o.classList.add("symbol-button","btn","btn-dark"),o.dataset.latex=e.latex,o.dataset.bsToggle="tooltip",o.dataset.bsTitle=e.tooltip;const n=document.createElement("span");n.id=`icon-${e.id}-${l.id}`,n.textContent=e.icon,o.append(n),l.toolbar.append(o),t.StaticMath(n,{mouseEvents:!1}),l.toolbar.tooltips.push(new bootstrap.Tooltip(o,{placement:"left",trigger:"hover",delay:{show:500,hide:0}})),o.addEventListener("click",(()=>{l.hasFocus=!0,l.mathField.cmd(o.dataset.latex),l.textarea.focus()}))}l.toolbar.addEventListener("keydown",(t=>{"Escape"===t.key&&(l.hasFocus=!1,r())})),l.toolbar.setPosition=()=>{const t=49*l.buttons.length+4,e=(()=>{const t=document.documentElement.getBoundingClientRect().height;return window.innerHeight>t?window.innerHeight:t})(),o=(()=>{let t=l.parentElement;for(;t&&t!==document;){const e=window.getComputedStyle(t).position;if("relative"===e)return t;if("fixed"===e)return;t=t.parentElement}})();if(o){const n=(()=>{const t=document.documentElement.getBoundingClientRect().width;return window.innerWidth>t?window.innerWidth:t})(),a=o.getBoundingClientRect();l.toolbar.style.right=window.scrollX+a.right+10-n+"px";const s=l.getBoundingClientRect();window.scrollY+s.top+s.height/2<t/2?(l.toolbar.style.top=`-${window.scrollY+a.top}px`,l.toolbar.style.bottom=t>e?window.scrollY+a.bottom-e+"px":null):window.scrollY+s.top+s.height/2+t/2>e?(l.toolbar.style.top=null,l.toolbar.style.bottom=window.scrollY+a.bottom-e+"px"):(l.toolbar.style.top=s.top+s.height/2-t/2-a.top+"px",l.toolbar.style.bottom=null)}else if(t>e)l.toolbar.style.top=0,l.toolbar.style.height="100%";else{const o=l.getBoundingClientRect(),n=window.scrollY+o.bottom-o.height/2-t/2,a=n+t;l.toolbar.style.top=`${n<0?0:a>e?e-t:n}px`,l.toolbar.style.height=null}},window.addEventListener("resize",l.toolbar.setPosition),l.toolbar.setPosition(),l.after(l.toolbar),setTimeout((()=>l.toolbar.style.opacity=1),0)}})),l.addEventListener("contextmenu",(t=>{t.preventDefault();const o=document.createElement("div");o.classList.add("dropdown","d-inline-block"),l.after(o);const n=document.createElement("a");n.classList.add("dropdown-toggle","d-none"),n.dataset.bsToggle="dropdown",n.href="#",o.append(n);const a=document.createElement("ul");a.classList.add("dropdown-menu");const s=document.createElement("li");a.append(s);const i=document.createElement("a");i.classList.add("dropdown-item"),i.href="#",i.textContent=e?"Disable Toolbar":"Enable Toolbar",s.append(i),o.append(a);const d=new bootstrap.Dropdown(n,{reference:l,offset:[l.offsetWidth,0]});d.show(),n.addEventListener("hidden.bs.dropdown",(()=>{d.dispose(),a.remove(),o.remove()})),i.addEventListener("click",(t=>{t.preventDefault(),e=!e,localStorage.setItem("MQEditorToolbarEnabled",e),!e&&l.toolbar&&(l.hasFocus=!1,r()),e&&!l.toolbar&&l.textarea.dispatchEvent(new Event("focusin")),d.hide(),l.textarea.focus()}),{once:!0})})),l.textarea.addEventListener("focusout",(()=>{l.hasFocus=!1,setTimeout(r,200)})),l.keydownHandler=t=>{if("Enter"==t.key){l.toolbar?.tooltips.forEach((t=>t.dispose())),l.toolbar?.remove(),delete l.toolbar,document.getElementById("previewAnswers_id")?.click(),document.querySelector("input[name=previewAnswers]")?.click();const t=l.textarea.closest("[name=problemMainForm]")?.id.replace("problemMainForm","previewAnswers");t&&document.getElementById(t)?.click()}},l.addEventListener("keydown",l.keydownHandler),l.mathField.latex(l.latexInput.value),l.mathField.moveToLeftEnd(),l.mathField.blur();for(const t of document.querySelectorAll("td a[data-answer-id]"))n.includes(t.dataset.answerId)&&(t.parentNode.classList.contains("ResultsWithoutError")?l.classList.add("correct"):l.classList.add("incorrect")),n===t.dataset.answerId&&t.addEventListener("click",(t=>{t.preventDefault(),l.textarea.focus()}));window.answerQuills[n]=l};document.querySelectorAll("[id^=MaThQuIlL_]").forEach((t=>o(t)));const n=new MutationObserver((t=>{for(const e of t)for(const t of e.addedNodes)t instanceof Element&&(t.id&&t.id.startsWith("MaThQuIlL_")?o(t):t.querySelectorAll("input[id^=MaThQuIlL_]").forEach((t=>o(t))))}));n.observe(document.body,{childList:!0,subtree:!0}),window.addEventListener("unload",(()=>n.disconnect()))})();